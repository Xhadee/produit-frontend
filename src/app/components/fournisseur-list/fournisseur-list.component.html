<div class="container-fluid py-4">

  <div class="header-glass p-4 mb-5 rounded-5 shadow-soft d-flex flex-column flex-md-row justify-content-between align-items-center gap-4">
    <div class="text-center text-md-start">
      <h2 class="title-theme fw-black mb-1">Partenaires</h2>
      <p class="text-secondary-adaptive mb-0">Gérez vos contacts et sources d'approvisionnement</p>
    </div>

    <div class="d-flex flex-grow-1 justify-content-center px-md-5">
      <div class="search-box w-100 max-width-500">
        <i class="bi bi-search search-icon"></i>
        <input type="text" class="form-control search-input shadow-none"
               [(ngModel)]="searchTerm" (input)="filtrerFournisseurs()"
               placeholder="Rechercher un partenaire...">
      </div>
    </div>

    <button class="btn btn-primary-gradient px-4 py-3 rounded-4 shadow-primary hover-lift fw-bold border-0"
            data-bs-toggle="modal" data-bs-target="#fournModal"
            (click)="preparerAjout()">
      <i class="bi bi-person-plus-fill me-2"></i>Nouveau Fournisseur
    </button>
  </div>

  <div class="row g-4">
    <div class="col-md-6 col-lg-4" *ngFor="let f of fournisseursFiltres">
      <div class="card border-0 shadow-soft h-100 fournisseur-card overflow-hidden"
           (click)="f.id && voirDetails(f.id)">

        <div class="card-accent-line"></div>

        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-start mb-4">
            <div class="avatar-supplier" [style.background-color]="getAvatarColor(f.nom)">
              {{ f.nom | slice:0:1 | uppercase }}
            </div>

            <div class="dropdown" (click)="$event.stopPropagation()">
              <button class="btn btn-link text-muted p-0 shadow-none" data-bs-toggle="dropdown">
                <i class="bi bi-three-dots-vertical h5"></i>
              </button>
              <ul class="dropdown-menu dropdown-menu-end border-0 shadow-lg p-2 rounded-4">
                <li><a class="dropdown-item py-2 rounded-3" (click)="preparerEdition(f, $event)" data-bs-toggle="modal" data-bs-target="#fournModal">
                  <i class="bi bi-pencil me-2 text-primary"></i>Modifier</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item py-2 rounded-3 text-danger" (click)="f.id && supprimer(f.id, $event)">
                  <i class="bi bi-trash me-2"></i>Supprimer</a></li>
              </ul>
            </div>
          </div>

          <h5 class="fw-black title-theme mb-1 text-truncate">{{ f.nom }}</h5>
          <div class="d-flex align-items-center mb-4">
            <span class="badge-active-dot"></span>
            <small class="text-muted fw-bold ms-2">Fournisseur Officiel</small>
          </div>

          <div class="contact-stack mb-4">
            <div class="d-flex align-items-center mb-2 text-secondary-adaptive small">
              <i class="bi bi-telephone-fill me-3 text-primary"></i> {{ f.telephone || 'Non renseigné' }}
            </div>
            <div class="d-flex align-items-center text-secondary-adaptive small">
              <i class="bi bi-envelope-at-fill me-3 text-primary"></i> {{ f.email || 'Pas d\'email' }}
            </div>
          </div>

          <div class="address-mini-card">
            <div class="d-flex align-items-center gap-3">
              <div class="icon-map-box">
                <i class="bi bi-geo-alt-fill text-white"></i>
              </div>
              <div class="overflow-hidden">
                <p class="address-label">Localisation</p>
                <p class="address-text text-truncate">{{ f.adresse || 'Adresse non renseignée' }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="fournModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-neo border-0 shadow-lg" style="border-radius: 30px;">
        <div class="modal-header border-0 pb-0 pt-4 px-4">
          <h5 class="fw-black title-theme h4">{{ isEditMode ? 'Modifier Partenaire' : 'Nouveau Partenaire' }}</h5>
          <button type="button" class="btn-close shadow-none" data-bs-dismiss="modal" id="closeFournModal"></button>
        </div>

        <form [formGroup]="fournisseurForm" (ngSubmit)="onSubmit()">
          <div class="modal-body p-4">
            <div class="mb-3">
              <label class="form-label small fw-bold text-muted text-uppercase">Nom de l'entreprise</label>
              <input type="text" class="form-control custom-input" formControlName="nom" placeholder="Ex: Dakar Digital Import">
            </div>

            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <label class="form-label small fw-bold text-muted text-uppercase">Téléphone</label>
                <input type="text" class="form-control custom-input" formControlName="telephone" placeholder="+221...">
              </div>
              <div class="col-md-6">
                <label class="form-label small fw-bold text-muted text-uppercase">Email</label>
                <input type="email" class="form-control custom-input" formControlName="email" placeholder="contact@cie.sn">
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label small fw-bold text-muted text-uppercase">Adresse du Siège</label>
              <textarea class="form-control custom-input" formControlName="adresse" rows="2" placeholder="Ex: Rue 10, Dakar, Sénégal"></textarea>
            </div>
          </div>

          <div class="modal-footer border-0 p-4 pt-0">
            <button type="submit" class="btn btn-primary-gradient w-100 rounded-pill py-3 fw-bold shadow-primary border-0"
                    [disabled]="fournisseurForm.invalid">
              <i class="bi bi-check-circle-fill me-2"></i>
              {{ isEditMode ? 'Enregistrer les modifications' : 'Confirmer la création' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
